{
    "extract_dfs": {
        "customer_scd4_current": {
            "file_format": "iceberg",
            "file_path": "iceberg.silver.customer_scd4_hist",
            "type": "read_iceberg",
            "date_column": "partition_date",
            "latency": -4
        }
    },
    "transform_dfs": {
        "customer_scd4_current": [
            {
                "op": "sql",
                "args": {
                    "query": "SELECT * FROM (SELECT *, ROW_NUMBER() OVER (PARTITION BY user_id ORDER BY updated_timestamp DESC) AS rn FROM customer_scd4_hist) tmp WHERE rn = 1 AND action IN ('INSERT','UPDATE')",
                    "view_name": "customer_scd4_hist"
                }
            }
        ]
    },
    "load": {
        "customer_scd4_current": {
            "type": "scd4_current",
            "table_name": "iceberg.silver.customer",
            "format": "iceberg",
            "partition_by": "partition_date"
        }
    }
}